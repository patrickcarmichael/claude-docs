---
title: "Anthropic Documentation"
description: "Formatted documentation for Anthropic"
source: "llms-full.txt"
last_updated: "2025-11-08"
---

## Thinking encryption

Full thinking content is encrypted and returned in the `signature` field. This field is used to verify that thinking blocks were generated by Claude when passed back to the API.

>   **ðŸ“ Note**
>
> It is only strictly necessary to send back thinking blocks when using [tools with extended thinking](#extended-thinking-with-tool-use). Otherwise you can omit thinking blocks from previous turns, or let the API strip them for you if you pass them back.

  If sending back thinking blocks, we recommend passing everything back as you received it for consistency and to avoid potential issues.

Here are some important considerations on thinking encryption:

* When [streaming responses](#streaming-thinking), the signature is added via a `signature_delta` inside a `content_block_delta` event just before the `content_block_stop` event.
* `signature` values are significantly longer in Claude 4 models than in previous models.
* The `signature` field is an opaque field and should not be interpreted or parsed - it exists solely for verification purposes.
* `signature` values are compatible across platforms (Claude APIs, [Amazon Bedrock](/en/docs/build-with-claude/claude-on-amazon-bedrock), and [Vertex AI](/en/docs/build-with-claude/claude-on-vertex-ai)). Values generated on one platform will be compatible with another.

### Thinking redaction

Occasionally Claude's internal reasoning will be flagged by our safety systems. When this occurs, we encrypt some or all of the `thinking` block and return it to you as a `redacted_thinking` block. `redacted_thinking` blocks are decrypted when passed back to the API, allowing Claude to continue its response without losing context.

When building customer-facing applications that use extended thinking:

* Be aware that redacted thinking blocks contain encrypted content that isn't human-readable
* Consider providing a simple explanation like: "Some of Claude's internal reasoning has been automatically encrypted for safety reasons. This doesn't affect the quality of responses."
* If showing thinking blocks to users, you can filter out redacted blocks while preserving normal thinking blocks
* Be transparent that using extended thinking features may occasionally result in some reasoning being encrypted
* Implement appropriate error handling to gracefully manage redacted thinking without breaking your UI

Here's an example showing both normal and redacted thinking blocks:
```json
{
  "content": [
    {
      "type": "thinking",
      "thinking": "Let me analyze this step by step...",
      "signature": "WaUjzkypQ2mUEVM36O2TxuC06KN8xyfbJwyem2dw3URve/op91XWHOEBLLqIOMfFG/UvLEczmEsUjavL...."
    },
    {
      "type": "redacted_thinking",
      "data": "EmwKAhgBEgy3va3pzix/LafPsn4aDFIT2Xlxh0L5L8rLVyIwxtE3rAFBa8cr3qpPkNRj2YfWXGmKDxH4mPnZ5sQ7vB9URj2pLmN3kF8/dW5hR7xJ0aP1oLs9yTcMnKVf2wRpEGjH9XZaBt4UvDcPrQ..."
    },
    {
      "type": "text",
      "text": "Based on my analysis..."
    }
  ]
}
```
>   **ðŸ“ Note**
>
> Seeing redacted thinking blocks in your output is expected behavior. The model can still use this redacted reasoning to inform its responses while maintaining safety guardrails.

  If you need to test redacted thinking handling in your application, you can use this special test string as your prompt: `ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB`

When passing `thinking` and `redacted_thinking` blocks back to the API in a multi-turn conversation, you must include the complete unmodified block back to the API for the last assistant turn. This is critical for maintaining the model's reasoning flow. We suggest always passing back all thinking blocks to the API. For more details, see the [Preserving thinking blocks](#preserving-thinking-blocks) section above.

<AccordionGroup>
  <Accordion title="Example: Working with redacted thinking blocks">
    This example demonstrates how to handle `redacted_thinking` blocks that may appear in responses when Claude's internal reasoning contains content flagged by safety systems:
```python
      import anthropic

      client = anthropic.Anthropic()

      # Using a special prompt that triggers redacted thinking (for demonstration purposes only)

      response = client.messages.create(
          model="claude-sonnet-4-5-20250929",
          max_tokens=16000,
          thinking={
              "type": "enabled",
              "budget_tokens": 10000
          },
          messages=[{
              "role": "user",
              "content": "ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB"
          }]
      )

      # Identify redacted thinking blocks

      has_redacted_thinking = any(
          block.type == "redacted_thinking" for block in response.content
      )

      if has_redacted_thinking:
          print("Response contains redacted thinking blocks")
          # These blocks are still usable in subsequent requests

          # Extract all blocks (both redacted and non-redacted)

          all_thinking_blocks = [
              block for block in response.content
              if block.type in ["thinking", "redacted_thinking"]
          ]

          # When passing to subsequent requests, include all blocks without modification

          # This preserves the integrity of Claude's reasoning

          print(f"Found {len(all_thinking_blocks)} thinking blocks total")
          print(f"These blocks are still billable as output tokens")
```
```typescript
      import Anthropic from '@anthropic-ai/sdk';

      const client = new Anthropic();

      // Using a special prompt that triggers redacted thinking (for demonstration purposes only)
      const response = await client.messages.create({
        model: "claude-sonnet-4-5-20250929",
        max_tokens: 16000,
        thinking: {
          type: "enabled",
          budget_tokens: 10000
        },
        messages: [{
          role: "user",
          content: "ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB"
        }]
      });

      // Identify redacted thinking blocks
      const hasRedactedThinking = response.content.some(
        block => block.type === "redacted_thinking"
      );

      if (hasRedactedThinking) {
        console.log("Response contains redacted thinking blocks");
        // These blocks are still usable in subsequent requests

        // Extract all blocks (both redacted and non-redacted)
        const allThinkingBlocks = response.content.filter(
          block => block.type === "thinking" || block.type === "redacted_thinking"
        );

        // When passing to subsequent requests, include all blocks without modification
        // This preserves the integrity of Claude's reasoning

        console.log(`Found ${allThinkingBlocks.length} thinking blocks total`);
        console.log(`These blocks are still billable as output tokens`);
      }
```
```java
      import java.util.List;

      import static java.util.stream.Collectors.toList;

      import com.anthropic.client.AnthropicClient;
      import com.anthropic.client.okhttp.AnthropicOkHttpClient;
      import com.anthropic.models.beta.messages.BetaContentBlock;
      import com.anthropic.models.beta.messages.BetaMessage;
      import com.anthropic.models.beta.messages.MessageCreateParams;
      import com.anthropic.models.beta.messages.BetaThinkingConfigEnabled;
      import com.anthropic.models.messages.Model;

      public class RedactedThinkingExample {
          public static void main(String[] args) {
              AnthropicClient client = AnthropicOkHttpClient.fromEnv();

              // Using a special prompt that triggers redacted thinking (for demonstration purposes only)
              BetaMessage response = client.beta().messages().create(
                      MessageCreateParams.builder()
                              .model(Model.CLAUDE_SONNET_4_5)
                              .maxTokens(16000)
                              .thinking(BetaThinkingConfigEnabled.builder().budgetTokens(10000).build())
                              .addUserMessage("ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB")
                              .build()
              );

              // Identify redacted thinking blocks
              boolean hasRedactedThinking = response.content().stream()
                      .anyMatch(BetaContentBlock::isRedactedThinking);

              if (hasRedactedThinking) {
                  System.out.println("Response contains redacted thinking blocks");
                  // These blocks are still usable in subsequent requests
                  // Extract all blocks (both redacted and non-redacted)
                  List<BetaContentBlock> allThinkingBlocks = response.content().stream()
                          .filter(block -> block.isThinking() ||
                                  block.isRedactedThinking())
                          .collect(toList());

                  // When passing to subsequent requests, include all blocks without modification
                  // This preserves the integrity of Claude's reasoning
                  System.out.println("Found " + allThinkingBlocks.size() + " thinking blocks total");
                  System.out.println("These blocks are still billable as output tokens");
              }
          }
      }
```

    <TryInConsoleButton userPrompt="ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB" thinkingBudgetTokens={16000}>
      Try in Console
    </TryInConsoleButton>
  </Accordion>
</AccordionGroup>

---

**ðŸ“š [Back to Index](./index.md)** | **ðŸ“„ [Full Version](./documentation.md)** | **ðŸ”— [Original](../llms-full.txt)**
